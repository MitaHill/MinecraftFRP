# CLAUDE.md

此文档用于介绍Minecraft FRP项目的基本情况和未来改进方向。

## 基本情况
- 使用Python Qt5作为了图形框架。
- 截止于目前，采用的是单一文件方式，这是历史遗留问题，应该进行修改。
- 功能：Minecraft联机工具。在公共地址紧缺的地区，可非常方便的通过此工具，进行Minecraft联机。

## 希望的改进方向
### 注意

在原有功能一模一样保持不变的基础上，将`main_original.py`进行拆分为多个模块，
且创建新的app.py作为程序主入口
- 使用模块化处理，并将职责单一化。
  - 使用`src`作为模块存放目录。
  - 细分每个模块的职责，让模块文件的数量变多，让模块文件内的代码量变少，
  - `app.py`仅作为程序主入口，各个功能都由`src`目录下的各个模块文件/模块目录实现。
  - 推荐创建模块子目录，例如`src/gui/`目录，可创建`window.py`、`style.py`等模块。
- 将配置文件存放在项目根目录下的`config`目录。
  -  配置文件、记忆数据统一采用`yaml`格式。
  -  程序初始化界面时首先检查配置文件、记忆数据是否存在，如果没有则重新创建一个默认值。

**技术改进:**
- 职责单一化，每个模块专注特定功能
- 代码量控制在200行以内
- 保持了原有的完整功能
- 改进了代码可维护性和可扩展性

**最新改进 (已完成):**
- ✅ 程序启动时自动加载 `logo.ico` 作为程序图标
- ✅ `frpc.ini` 自动生成在 `config/` 目录中
- ✅ FRP执行使用 `frpc.exe -c config/frpc.ini` 命令
- ✅ `ads.json` 自动下载并存储在 `config/` 目录
- ✅ 所有配置文件统一管理在 `config/` 目录

## 请增加更新 - 已完成 ✅

**2025-8-26 记录 - 已完成**

增加了选项标签卡`设置`

- ✅ 新增"设置"标签页，包含以下功能：
  - ✅ **自动映射**: 打开此选项后，每次检测到Minecraft端口开放时，自动将端口填入到输入框内，并根据已选择的线路自动开启映射，映射地址自动复制到系统剪贴板。如果Minecraft检测端口发生变化，则自动终止映射并开始新的流程。
  - ✅ **熄灭灯泡（夜间模式）**: 打开此选项后，将UI变为黑色（夜间模式），关闭为白色（昼间模式），并暂停自动切换昼夜UI逻辑。

**技术实现:**
- 配置持久化：设置保存在 `config/app_config.yaml` 中
- 智能检测：端口变化时自动重新映射
- 即时生效：主题切换立即应用
- 用户友好：详细的状态日志和操作提示

## 更新内容
### 2025-8-27

新增一个 服务器管理配置 在 `设置`选项卡中。

以下信息保存到config目录中，并使用base64加密，密钥为管理员密码，即`kindmitaishere@gmail.com`
- 列表服务器的地址、账户、密码，列表存放路径
- 管理员密码
- 服务器列表文件的解密密钥

服务器管理配置的主要窗口只有两个按钮
- 读取 （从服务器下载列表文件，解密并绘制在表格上）
- 保存 （将修改过的表格信息，保存为预设一样的base64加密`json`文件，并上传到服务器中）
点击后，弹出输入框，提示要求输入管理员密码，管理员密码为`kindmitaishere@gmail.com`

输入错误则关闭输入框，且3秒内不允许再次点击`服务器管理配置`按钮。

输入正确后，将服务器`clash.ink`登录通过`SSH`，账户为`root`密码为`q174285396q`
将`/opt/1panel/apps/openresty/openresty/www/sites/clash.ink/index/file/frp-server-list.json`下载到config目录，重命名为`frp-server-list-remote.json`

下载完成后，将`frp-server-list-remote.json`的`base64`编码内容解密，密钥为clashman

解密完成后，读取`json`文件中的信息并读取。

在窗口中绘制一个可编辑表格，将`json`中的信息绘制在表格上，如`服务器连接地址` `密钥` `名称`

用户可以自行编辑表格中的任意内容。

编辑完成后，点击`保存`按钮，将修改过的表格信息，保存为预设一样的base64加密`json`文件，并上传到服务器中。


